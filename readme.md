# Directory

> [Source-code](https://github.com/GICSAFePhD/Layouts/blob/main/README.md#source-code)

> [Usage](https://github.com/GICSAFePhD/Layouts/blob/main/README.md#Usage)
  
<table>
	<tbody>
		<tr>
			<td>Examples</td>
			<td>Section</td>
			<td>URL</td>
			<td># Tracks</td>
			<td># Switches</td>
			<td># Crossings</td>
			<td># Platforms</td>
			<td># Signals</td>
			<td># Routes</td>
		</tr>
		<tr>
			<td rowspan="4" align="center">1</td>
			<td>Description</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_1/Readme.md#description">Link</a></td>
			<td rowspan="4" align="center">11</td>
			<td rowspan="4" align="center">5</td>
			<td rowspan="4" align="center">2</td>
			<td rowspan="4" align="center">2</td>
			<td rowspan="4" align="center">29</td>
			<td rowspan="4" align="center">14</td>
		</tr>
		<tr>
			<td>Step by Step</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_1/Readme.md#step-by-step">Link</a></td>
		</tr>
		<tr>
			<td>Original table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_1/Readme.md#original-table">Link</a></td>
		</tr>
		<tr>
			<td>Generated table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_1/Readme.md#generated-table">Link</a></td>
		</tr>
		<tr>
			<td rowspan="4" align="center">2</td>
			<td>Description</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_2/Readme.md#description">Link</a></td>
			<td rowspan="4" align="center">7</td>
			<td rowspan="4" align="center">3</td>
			<td rowspan="4" align="center">1</td>
			<td rowspan="4" align="center">2</td>
			<td rowspan="4" align="center">15</td>
			<td rowspan="4" align="center">5</td>
		</tr>
		<tr>
			<td>Step by Step</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_2/Readme.md#step-by-step">Link</a></td>
		</tr>
		<tr>
			<td>Original table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_2/Readme.md#original-table">Link</a></td>
		</tr>
		<tr>
			<td>Generated table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_2/Readme.md#generated-table">Link</a></td>
		</tr>
		<tr>
			<td rowspan="4" align="center">3</td>
			<td>Description</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_3/Readme.md#description">Link</a></td>
			<td rowspan="4" align="center">74</td>
			<td rowspan="4" align="center">21</td>
			<td rowspan="4" align="center">3</td>
			<td rowspan="4" align="center">13</td>
			<td rowspan="4" align="center">94</td>
			<td rowspan="4" align="center">35</td>
		</tr>
		<tr>
			<td>Step by Step</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_3/Readme.md#step-by-step">Link</a></td>
		</tr>
		<tr>
			<td>Original table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_3/Readme.md#original-table">Link</a></td>
		</tr>
		<tr>
			<td>Generated table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_3/Readme.md#generated-table">Link</a></td>
		</tr>
		<tr>
			<td rowspan="4" align="center">4</td>
			<td>Description</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_4/Readme.md#description">Link</a></td>
			<td rowspan="4" align="center">47</td>
			<td rowspan="4" align="center">23</td>
			<td rowspan="4" align="center">6</td>
			<td rowspan="4" align="center">0</td>
			<td rowspan="4" align="center">95</td>
			<td rowspan="4" align="center">7</td>
		</tr>
		<tr>
			<td>Step by Step</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_4/Readme.md#step-by-step">Link</a></td>
		</tr>
		<tr>
			<td>Original table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_4/Readme.md#original-table">Link</a></td>
		</tr>
		<tr>
			<td>Generated table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_4/Readme.md#generated-table">Link</a></td>
		</tr>
		<tr>
			<td rowspan="4" align="center">5</td>
			<td>Description</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_5/Readme.md#description">Link</a></td>
			<td rowspan="4" align="center">8</td>
			<td rowspan="4" align="center">4</td>
			<td rowspan="4" align="center">0</td>
			<td rowspan="4" align="center">0</td>
			<td rowspan="4" align="center">24</td>
			<td rowspan="4" align="center">16</td>
		</tr>
		<tr>
			<td>Step by Step</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_5/Readme.md#step-by-step">Link</a></td>
		</tr>
		<tr>
			<td>Original table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_5/Readme.md#original-table">Link</a></td>
		</tr>
		<tr>
			<td>Generated table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_5/Readme.md#generated-table">Link</a></td>
		</tr>
		<tr>
			<td rowspan="4" align="center">6</td>
			<td>Description</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_6/Readme.md#description">Link</a></td>
			<td rowspan="4" align="center">11</td>
			<td rowspan="4" align="center">5</td>
			<td rowspan="4" align="center">0</td>
			<td rowspan="4" align="center">0</td>
			<td rowspan="4" align="center">30</td>
			<td rowspan="4" align="center">16</td>
		</tr>
		<tr>
			<td>Step by Step</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_6/Readme.md#step-by-step">Link</a></td>
		</tr>
		<tr>
			<td>Original table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_6/Readme.md#original-table">Link</a></td>
		</tr>
		<tr>
			<td>Generated table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_6/Readme.md#generated-table">Link</a></td>
		</tr>
		<tr>
			<td rowspan="4" align="center">7</td>
			<td>Description</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_7/Readme.md#description">Link</a></td>
			<td rowspan="4" align="center">7</td>
			<td rowspan="4" align="center">3</td>
			<td rowspan="4" align="center">0</td>
			<td rowspan="4" align="center">0</td>
			<td rowspan="4" align="center">17</td>
			<td rowspan="4" align="center">8</td>
		</tr>
		<tr>
			<td>Step by Step</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_7/Readme.md#step-by-step">Link</a></td>
		</tr>
		<tr>
			<td>Original table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_7/Readme.md#original-table">Link</a></td>
		</tr>
		<tr>
			<td>Generated table</td>
			<td><a href="https://github.com/GICSAFePhD/RailML/tree/main/Layouts/Example_7/Readme.md#generated-table">Link</a></td>
		</tr>
	</tbody>
</table>

# Source-code

<table bakground="FFF">
<tr> <td><b>Part</b></td> <td><b>Description</b></td> <td><b>Repository URL</b></td> </tr>
<!-- Pegar tabla de excel inicio -->

<tr><td rowspan="1" align="center">APP</td>
<td>Run Main.py to use the full tool</td><td><a href="https://github.com/GICSAFePhD/App">Link</a></td></tr>
  
<tr><td rowspan="1" align="center">RNA</td>
<td>Railway Network Analyzer</td><td><a href="https://github.com/GICSAFePhD/RNA">Link</a></td></tr>
 
<tr><td rowspan="1" align="center">ACG</td>
<td>Automatic Code Generator (under repairment)</td><td><a href="https://github.com/GICSAFePhD/ACG">Link</a></td></tr>
<!--  
<tr><td rowspan="1" align="center">AGG</td>
<td>Automatic Graphic Generator (to be implemented)</td><td><a href="https://github.com/GICSAFePhD/AGG">Link</a></td></tr>
  
<tr><td rowspan="1" align="center">ATA</td>
<td>Automatic Test Analyzer (to be implemented)</td><td><a href="https://github.com/GICSAFePhD/ATA">Link</a></td></tr>
  
<tr><td rowspan="1" align="center">ATG</td>
<td>Automatic Test Generator (to be implemented)</td><td><a href="https://github.com/GICSAFePhD/ATG">Link</a></td></tr>
-->  
<tr><td rowspan="1" align="center">railML</td>
<td>railML library</td><td><a href="https://github.com/GICSAFePhD/railML">Link</a></td></tr>
 
<tr><td rowspan="1" align="center">Layouts</td>
<td>Examples</td><td><a href="https://github.com/GICSAFePhD/Layouts">Link</a></td></tr>  

<!-- Pegar tabla de excel fin -->
</table>

## Usage

1. Download all the folders (app, railML, RNA, ACG, Layouts)
2. In APP/main.py edit INPUT_FILE and OUTPUT_FILE
* OUTPUT_FILE can be any name with extension .railml
* INPUT_FILE must exists in \Layouts as a .railml file

```python
i = 10
INPUT_FILE  = "C:\PhD\RailML\Layouts\Example_"+str(i)+".railml"
OUTPUT_FILE = "C:\PhD\RailML\Layouts\Example_"+str(i)+"_B.railml"
```
index i was used to select examples, but any name can be used instead, if it exists in \Layouts

3. Set up configuration

* Function move_signals can be enabled (to avoid signal overlapping) or disabled (to allow signal overllaping).
```python
move_signals(signals,nodes,TRUE / FALSE)
```
* The distance to avoid overllaping is set as 90
```python
move_step = 90
```
* Function reduce_signals can be commented to enable / disable signalling simplification.(to avoid signal overlapping) or disabled (to allow signal overllaping)
```python
reduce_signals(signals,signal_placement)
```
* The distance for horizontal inheritance can be set in 
```python
def signal_simplification_by_proximity(signal_placement,crossing_nodes,platforms_node):
    distance = 300
    ...
```
* The distance for CDL zones can be set in 
```python
def find_signal_positions(nodes,netPaths,switchesIS,tracks,trainDetectionElements,bufferStops,levelCrossingsIS,platforms):
    signal_placement = {}
    step = 200
    ...
```
* The distance for every rail element can be set in their respective functions

```python
def find_signals_lineborders(netPaths,nodes,borders,signals):
    step = 100
    ...
```
```python
def find_signals_bufferStops(netPaths,nodes,bufferStops,signals):
    step = 100
    ...
```
```python
def find_signals_joints(signal_placement,nodes,netPaths,trainDetectionElements,signals):
    distance = 200
    ...
```
```python
def find_signals_platforms(signal_placement,nodes,netPaths,platforms,signals):
    distance = 300
    ...
```
```python
def find_signals_crossings(signal_placement,nodes,netPaths,levelCrossingsIS,signals):
    distance = 250
    ...
```
Switches cannot be configured, they use the CDL configuration.

* In find_signals() a full section can be commented to enable / disable the signal generation due to particular rail elements
```python
def find_signals(safe_point_file,signal_placement,nodes,netPaths,switchesIS,tracks,trainDetectionElements,borders,bufferStops,levelCrossingsIS,platforms):
    ...
    # Find signals for platforms
    #signals = find_signals_platforms(signal_placement,nodes,netPaths,platforms,signals)
    #if [*signals] != printed_signals:
    #    print(f' Creating signals for platforms:{[x for x in [*signals] if x not in printed_signals]}')
    #printed_signals = [*signals]
    ...
```
In this way, signals due to platforms will not be generated.

It is NOT recommended to edit any other parameter.

4. Run main.py to see the next output (for example 2)
```
#################### Starting Railway Network Analyzer ####################
Reading .railML file  
Creating railML object
Analyzing railML object
 Analyzing graph
ne14 [-1521, 450] [-560, 450] True >> False
ne15 [-1521, 300] [-560, 450] True >> False
ne16 [-560, 450] [516, 450] True >> False
ne17 [516, 450] [666, 300] True >> False
ne18 [516, 450] [1521, 450] True >> False
ne19 [666, 300] [28, 300] False << True
ne20 [666, 300] [1521, 300] True >> False
 The network is connected
 Analyzing infrastructure --> Infrastructure.RNA
 Detecting Danger --> Safe_points.RNA
  ne14 has a Platform[plf116] @ [-1075, -450]
  ne15 has a Curve(2 lines) @ [[-710, 300]]
  ne16 has a LevelCrossing[lcr120] @ [-192, -450]
  ne18 has a Platform[plf117] @ [1111, -450]
  ne19 has a Middle point @ [347.0, 300]
  ne20 has a Middle point @ [1093.5, 300]
 Creating Signalling --> Signalling.RNA
 Creating signals for bufferstops:['sig01', 'sig02']
 Creating signals for crossings:['sig07', 'sig08']
 Creating signals for platforms:['sig09', 'sig10', 'sig11', 'sig12']
 Creating signals for switches:['sig13', 'sig14', 'sig15', 'sig16', 'sig17', 'sig18', 'sig19', 'sig20', 'sig21', 'sig22']
 Reducing redundant signals
 No signals found --> Creating new signalling structure
 Signals structure found!
 Detecting Routes --> Routes.RNA
RML object's size: 48 Bytes
Exporting .railML file
```


